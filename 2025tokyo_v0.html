<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>æ±äº¬ãƒ»æ©«æ¿±ãƒ»éŒå€‰ãƒ»æ²³å£æ¹– 11æ—¥è¡Œç¨‹ â€” åˆç‰ˆ</title>
    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700;800&family=Noto+Serif+TC:wght@700;800&display=swap" rel="stylesheet">
    <style>
      summary::-webkit-details-marker { display: none; }
      body { font-family: 'Noto Sans TC', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, Arial, 'PingFang TC', 'Microsoft JhengHei', 'Noto Sans CJK TC', sans-serif; }
      .title-font { font-family: 'Noto Serif TC', ui-serif, Georgia, serif; letter-spacing: .2px; }

      /* Gallery layout */
      .gallery-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: .5rem; }
      @media (min-width: 768px) { .gallery-grid { grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); } }
      .gallery-item { overflow:hidden; border-radius: .5rem; border:1px solid rgb(229 231 235); background:#fff; }
      .aspect-fixed { aspect-ratio: 4/3; }
      .gallery-item img { width:100%; height:100%; object-fit: cover; display:block; }

      /* Toggle: natural aspect ratio mode */
      .mode-natural .gallery-item { aspect-ratio: auto; }
      .mode-natural .gallery-item img { height:auto; object-fit: contain; background:#000; }

      /* Lightbox */
      dialog#lightbox { width: min(96vw, 1200px); border: none; padding: 0; background: transparent; }
      dialog#lightbox::backdrop { background: rgba(0,0,0,.7); }
      .lightbox-inner { position: relative; padding: .5rem; background: #000; border-radius: .75rem; }
      .lightbox-img { max-width: 92vw; max-height: 86vh; display: block; margin: auto; }
      .lightbox-close { position:absolute; top:.5rem; right:.5rem; background: rgba(255,255,255,.9); border: 1px solid rgb(229 231 235); padding: .25rem .5rem; border-radius: .5rem; font-size: .875rem; }
    </style>
  </head>
  <body class="min-h-screen bg-neutral-50 body-font">
    <!-- é ‚éƒ¨å·¥å…·åˆ— -->
    <div class="sticky top-0 z-30 backdrop-blur supports-[backdrop-filter]:bg-white/70 bg-white/80 border-b">
      <div class="mx-auto max-w-6xl px-4 py-3 flex items-center gap-3">
        <div class="flex items-center gap-2">
          <span class="inline-block w-5 h-5 rounded bg-black"></span>
          <h1 class="text-xl sm:text-2xl font-semibold tracking-tight title-font">æ±äº¬ãƒ»æ©«æ¿±ãƒ»éŒå€‰ãƒ»æ²³å£æ¹– 11æ—¥è¡Œç¨‹</h1>
        </div>
        <div class="ml-auto flex items-center gap-2">
          <button id="modeToggle" class="border rounded-md px-3 py-1.5 text-xs">é¡¯ç¤ºæ¨¡å¼ï¼šä¸€è‡´å°ºå¯¸</button>
          <button id="dljson" class="bg-black text-white rounded-md px-3 py-1.5 text-xs">åŒ¯å‡º JSON</button>
        </div>
      </div>
    </div>

    <main class="mx-auto max-w-6xl px-4 pb-16 pt-6">
      <!-- Hero -->
      <section class="mb-6">
        <div class="relative overflow-hidden rounded-2xl border shadow-sm">
          <img src="https://static.gltjp.com/glt/data/article/22000/21054/20250619_195350_87a39b19_w1920.webp" alt="Hero" class="w-full h-64 object-cover" fetchpriority="high" referrerpolicy="no-referrer" crossorigin="anonymous">
        </div>
      </section>

      <div class="my-6 border-t"></div>

      <!-- èˆªç­ï¼ˆå¯é¸ï¼‰ -->
      <section class="mb-8" id="flights">
        <div class="flex items-center gap-2 py-2">
          <span class="text-xl">âœˆï¸</span>
          <h2 class="text-2xl font-semibold tracking-tight title-font">èˆªç­</h2>
        </div>
        <div class="shadow-sm rounded-xl border bg-white scroll-mt-24">
          <div class="p-3 grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- å»ç¨‹ -->
            <div class="rounded-xl border p-4">
              <div class="flex items-center gap-2 mb-2"><span class="inline-flex items-center justify-center rounded-full bg-gray-100 border px-2 py-0.5 text-xs">å»ç¨‹</span></div>
              <div class="text-base text-gray-700 font-medium">æ—¥æœ¬èˆªç©º JAL</div>
              <div class="flex items-center gap-2 mt-1 text-sm"><span class="inline-flex items-center rounded-full bg-gray-100 border px-2 py-0.5">JL96</span><span>2025/12/11 (å››)</span></div>
              <div class="grid grid-cols-2 gap-2 items-center mt-2 text-base">
                <div class="flex items-center gap-2 text-lg font-semibold">09:10</div><div class="text-right text-gray-500">å°åŒ—æ¾å±±æ©Ÿå ´ ç¬¬ä¸€èˆªå»ˆ (TSA T1)</div>
                <div class="flex items-center gap-2 text-lg font-semibold">13:00</div><div class="text-right text-gray-500">ç¾½ç”°æ©Ÿå ´ ç¬¬ä¸‰èˆªå»ˆ (HND T3)</div>
              </div>
            </div>
            <!-- å›ç¨‹ -->
            <div class="rounded-xl border p-4">
              <div class="flex items-center gap-2 mb-2"><span class="inline-flex items-center justify-center rounded-full bg-gray-100 border px-2 py-0.5 text-xs">å›ç¨‹</span></div>
              <div class="text-base text-gray-700 font-medium">æ—¥æœ¬èˆªç©º JAL</div>
              <div class="flex items-center gap-2 mt-1 text-sm"><span class="inline-flex items-center rounded-full bg-gray-100 border px-2 py-0.5">JL97</span><span>2025/12/21 (æ—¥)</span></div>
              <div class="grid grid-cols-2 gap-2 items-center mt-2 text-base">
                <div class="flex items-center gap-2 text-lg font-semibold">08:40</div>
                <div class="text-right text-gray-500">ç¾½ç”°æ©Ÿå ´ ç¬¬ä¸‰èˆªå»ˆ (HND T3)</div>
                <div class="flex items-center gap-2 text-lg font-semibold">11:40</div>
                <div class="text-right text-gray-500">å°åŒ—æ¾å±±æ©Ÿå ´ ç¬¬ä¸€èˆªå»ˆ (TSA T1)</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- æ¯æ—¥è¡Œç¨‹ï¼ˆç”± JS æ¸²æŸ“ï¼‰ -->
      <section class="mb-8" id="itinerary">
        <div class="flex items-center gap-2 py-2">
          <span class="text-xl">ğŸ—“ï¸</span>
          <h2 class="text-2xl font-semibold tracking-tight title-font">æ¯æ—¥è¡Œç¨‹</h2>
        </div>
        <div id="itineraryList" class="space-y-6"></div>
      </section>

      <!-- Lightbox (click-to-zoom) -->
      <dialog id="lightbox">
        <div class="lightbox-inner">
          <img id="lightboxImg" class="lightbox-img" alt="preview">
          <button id="lightboxClose" class="lightbox-close">é—œé–‰ âœ•</button>
        </div>
      </dialog>
    </main>

    <script>
      // è³‡æ–™ï¼šå¾ Word å…§å®¹è½ç‰ˆç‚ºçµæ§‹åŒ–ï¼ˆv0.1ï¼‰
      const DATA = {
        title: "æ±äº¬ãƒ»æ©«æ¿±ãƒ»éŒå€‰ãƒ»æ²³å£æ¹– 11æ—¥è¡Œç¨‹",
        subtitle: "åˆç‰ˆéª¨æ¶ï¼ˆå·²å¥—ç”¨ D1â€“D11ï¼›D5=ç´…ç·šã€D6=ç¶ ç·šï¼‰",
        hero: { image: "https://static.gltjp.com/glt/data/article/22000/21054/20250619_195350_87a39b19_w1920.webp", caption: "ç¤ºæ„åœ–ï¼Œå¯æ›¿æ›" },
        flights: {
          outbound: { airline: "æ—¥æœ¬èˆªç©º JAL", number: "JL96", date: "2025/12/11 (å››)", depTime: "09:10", dep: "å°åŒ—æ¾å±± ç¬¬ä¸€èˆªå»ˆ TSA", arrTime: "13:00", arr: "ç¾½ç”° ç¬¬ä¸‰èˆªå»ˆ HND" },
          inbound:  { airline: "æ—¥æœ¬èˆªç©º JAL", number: "JL97", date: "2025/12/21 (æ—¥)", depTime: "08:40", dep: "ç¾½ç”° ç¬¬ä¸‰èˆªå»ˆ HND", arrTime: "11:40", arr: "å°åŒ—æ¾å±± ç¬¬ä¸€èˆªå»ˆ TSA" }
        },
        itinerary: [
          { day:1, date:"2025/12/11 (å››)", title:"æ¾å±± â†’ ç¾½ç”° â†’ æ©«æ¿±ï½œæ¸¯æœªä¾†é»ƒæ˜æ•£æ­¥", gallery:[
            "https://yokohama-air-cabin.jp/publish/wp-content/uploads/2021/11/03.jpg",
            "https://www.fashion-press.net/img/news/138133/WJ4.jpg",
            "https://www.fashion-press.net/img/news/124094/xLI.jpg"
          ] },
          { day:2, date:"2025/12/12 (äº”)", title:"éŒå€‰æ•£æ­¥â‘ ï½œé¶´å²¡å…«å¹¡å®®ãƒ»å°ç”ºé€šãƒ»å ±åœ‹å¯º", gallery:[
            "https://www.kanagawa-kankou.or.jp/storage/post_picture/[1200_1200]_20240119121738_pixta_79365946_M.jpg",
            "https://static.gltjp.com/glt/data/article/21000/20310/20230510_115855_6a144d1c_w1920.webp",
            "https://static.gltjp.com/glt/data/directory/12000/11143/20200813_111648_6f8949ba_w1920.webp",
            "https://static.gltjp.com/glt/data/article/21000/20310/20230510_115447_51e5879d_w1920.webp"
          ] },
          { day:3, date:"2025/12/13 (å…­)", title:"éŒå€‰æ•£æ­¥â‘¡ï½œé•·è°·å¯ºãƒ»å¤§ä½›ãƒ»æ±Ÿä¹‹å³¶ã€æ¹˜å—ä¹‹å¯¶çŸ³ã€", gallery:[
            "https://upload.wikimedia.org/wikipedia/commons/c/cf/230128_Kamakura_Daibutsu_Japan04s3.jpg",
            "https://www.hasedera.jp/sys2024/wp-content/uploads/2024/03/024d2e1f23b81a5d21e99c49ddce4a2f.jpg",
            "https://enokama.jp/wp-content/uploads/2022/06/23_Course1_Enoden-2.jpg",
            "https://trip.pref.kanagawa.jp/img/spots/photos/hero/93cb7c954a73c5263bfce3baaa6dc656-1920x1080.jpg",
          ] },
          { day:4, date:"2025/12/14 (æ—¥)", title:"å¾¡æ®¿å ´ï½œæ™‚ä¹‹æ –ç‡ˆé£¾ãƒ»æº«æ³‰ä¼‘æ¯", gallery:[
            "https://www.tokinosumika.com/wp-content/themes/tokinosumika-cms_20240703/img/img_page_list/asobu/img_asobu9.jpg",
            "https://www.tokinosumika.com/wp-content/uploads/2025/10/%E3%82%B9%E3%83%AD%E3%83%BC%E5%A4%9C%E6%99%AF-1536x1152.jpg",
            "https://www.tokinosumika.com/wp-content/uploads/2025/10/%E3%83%84%E3%83%AA%E3%83%BC-1536x1152.jpg",
            "https://www.tokinosumika.com/wp-content/themes/tokinosumika-cms_20240703/img/activity/hunsui/hunsui14.jpg",
          ] },
          { day:5, date:"2025/12/15 (ä¸€)", title:"æ²³å£æ¹–ï½œå‘¨éŠå·´å£«ã€ç´…ç·šã€ç²¾è¯", gallery:[
            "https://www.fujiginkei.jp/images/img_main_home_0101.jpg",
            "https://d10pyp7ylo9bub.cloudfront.net/2018/03/amain1.jpg",
            "https://d1grca2t3zpuug.cloudfront.net/2025/05/kk24119252_m-870x500-1747986200.webp",
            "https://d1grca2t3zpuug.cloudfront.net/2024/03/20240301oishi2.jpg",
          ] },
          { day:6, date:"2025/12/16 (äºŒ)", title:"æ²³å£æ¹–ï½œå‘¨éŠå·´å£«ã€ç¶ ç·šã€ãƒ»è¥¿æ¹–æ…¢éŠ", gallery:[
            "https://saikoiyashinosatonenba.jp/wp-content/uploads/2020/12/gallery_winter_002.jpg",
            "https://www.mtfujiropeway.jp/about/cqotof0000000cqq-img/cqotof0000000d62.jpg",
            "https://www.mtfujiropeway.jp/about/cqotof0000000cqq-img/cqotof0000000d4z.jpg",
            "https://www.fujigokokisen.jp/images/appare/gallery/2.jpg",
          ] },
          { day:7, date:"2025/12/17 (ä¸‰)", title:"ä¸‹å‰ç”°ãƒ»æ–°å€‰å¯Œå£«æ·ºé–“ç¥ç¤¾ â†’ å¯Œå£«å›éŠ â†’ æ±äº¬", gallery:[
            "https://mediaim.expedia.com/destination/1/f35a4ca1d1c5d73247e253ac69f1a55b.jpg",
            "https://static.gltjp.com/glt/data/article/22000/21023/20250520_130727_d9968df9_w1920.webp",
            "https://www.fujikyu-railway.jp/common/images/fujikaiyuu/train1.jpg",
            "https://www.fashion-press.net/img/news/125226/rdg.jpg",
          ] },
          { day:8, date:"2025/12/18 (å››)", title:"æ±äº¬ï½œæ™´ç©ºå¡”æ•´æ—¥ï¼ˆè§€æ™¯å°ãƒ»Solamachiãƒ»å¢¨ç”°æ°´æ—é¤¨ï¼‰", gallery:[
            "https://d4y1bmgncyek9.cloudfront.net/uploads/activity/images/454/large_07ca9b46-cc82-4151-a3bb-372444a2e885.jpg",
            "https://res.klook.com/image/upload/fl_lossy.progressive,q_85/c_fill,w_1000/v1617785705/blog/cgwtxi43nqlqv7peo4bh.webp",
            "https://svcstrg.cld.navitime.jp/travelguide/p13060002/p13060002_01.jpg",
            "https://www.fashion-press.net/img/news/110181/zGM.jpg",
          ] },
          { day:9, date:"2025/12/19 (äº”)", title:"æ±äº¬ï½œæ±äº¬è»Šç«™ãƒ»ä¸¸ä¹‹å…§ãƒ»å…­æœ¬æœ¨ç‡ˆé£¾", gallery:[
            "https://www.bubu-jp.com/wp-content/uploads/2024/03/pixta_92563639_M.jpg",
            "https://www.fashion-press.net/img/news/138459/cMA.jpg",
            "https://www.fashion-press.net/img/news/138783/aPk.jpg",
            "https://www.fashion-press.net/img/news/138783/bl8.jpg",
          ] },
          { day:10, date:"2025/12/20 (å…­)", title:"æ±äº¬ï½œæ¾€è°·æ¢ç´¢ â†’ ç¾½ç”°é£¯åº—å…¥ä½", gallery:[
          "https://www.gotokyo.org/tc/destinations/western-tokyo/shibuya/images/main.jpg",
          "https://www.shibuya-scramble-square.com/sky/images/share_image.png",
          "https://www.ppaper.net/wp-content/uploads/2024/02/img_65dcd86848b37.jpg",
          "https://www.fashion-press.net/img/news/111293/AWA.jpg",
          ] },
          { day:11, date:"2025/12/21 (æ—¥)", title:"ç¾½ç”° â†’ æ¾å±±ï½œè¿”å°æ—¥", gallery:[
          "https://tokyo-haneda.com/site_resource/enjoy/img/enjoy__img_recommended_deck_t3_01.jpg",
          "https://tokyo-haneda.com/site_resource/enjoy/img/enjoy__img_recommended_deck_t1_04.jpg",
          ] }
        ]
      };

      const DETAILS = {
        1: { // æ©«æ¿±
          transport: [
            "JL96 æ¾å±±ä¸€èˆª 09:10 â†’ ç¾½ç”°ä¸‰èˆª 13:00",
            "ç¾½ç”° â†’ æ©«æ¿±ï¼šäº¬æ€¥ç·šç´„30åˆ†ç›´é”ï¼Œè½‰ä¹˜å°‘ã€è¡Œæå‹å–„",
            "å‚æ™šå‰å¾€ æ¸¯æœªä¾† æµ·é‚Šçœ‹å¤•é™½èˆ‡ç‡ˆé£¾"
          ],
          meals: { breakfast: "â€”", lunch: "æ©Ÿä¸Š/è‡ªç†", dinner: "æ¸¯æœªä¾†/ç´…ç£šå€‰åº«å‘¨é‚Š é¤å»³" },
          lodging: "Hotel New Otani Yokohama Premiumï¼ˆæ–°å¤§è°·æ©«æ¿±ï¼‰",
          summary: "æŠµé”æ—¥æœ¬å¾Œç›´é”æ©«æ¿±ï¼Œé»ƒæ˜ï½å¤œé–“æ•£æ­¥æ¸¯æœªä¾†ã€ç´…ç£šå€‰åº«èˆ‡ YOKOHAMA MILIGHT ç‡ˆæµ·ã€‚",
          sections: [
            { title: "æ™¯é»èˆ‡äº®é»", items:["æ¸¯æœªä¾†æµ·ç£æ­¥é“ï¼ˆå¹³å¦å¥½èµ°ï¼‰","ç´…ç£šå€‰åº«è–èª•å¸‚é›†ï¼ˆå­£ç¯€é™å®šï¼‰","YOKOHAMA MILIGHT ç‡ˆæµ·"]},
            { title: "é¤é£²å»ºè­°", items:["Bills ç´…ç£šå€‰åº«åº—","Steak House B&M","Anniversaire CafÃ©"]},
            { title: "å°æé†’", items:["å‡æ—¥äººæ½®å¤šè«‹æ”¾æ…¢","æµ·é¢¨å¤§æ³¨æ„ä¿æš–èˆ‡é˜²æ»‘"]}
          ]
        },
        2: { // éŒå€‰â‘ 
          transport: ["æ©«æ¿± â†’ éŒå€‰ ç´„35åˆ†ï¼ˆJR/ç§éµï¼‰","ä»¥æ­¥è¡Œ+çŸ­ç¨‹å…¬è»Šç‚ºä¸»","ä¸‹åˆå®‰æ’ å ±åœ‹å¯º ç«¹æ—èŒ¶å±‹"],
          meals: { breakfast: "â€”", lunch: "éŒå€‰äº”å±± / æ®µè‘›ã“å¯¿ã€…", dinner: "ä¸ƒé‡Œæ¿± Bills æˆ–é£¯åº—" },
          lodging: "Kamakura Prince Hotelï¼ˆéŒå€‰ç‹å­ï¼‰",
          summary: "é¶´å²¡å…«å¹¡å®®ã€å°ç”ºé€šæ¡è²·èˆ‡ç”œé»ï¼Œåˆå¾Œå ±åœ‹å¯ºæŠ¹èŒ¶ï¼Œæ™šå®¿ä¸ƒé‡Œæ¿±æµ·æ™¯æˆ¿ã€‚",
          sections: [
            { title: "æ™¯é»èˆ‡äº®é»", items:["é¶´å²¡å…«å¹¡å®®","å°ç”ºé€š å•†åº—è¡—","å ±åœ‹å¯º ç«¹æ—èˆ‡æŠ¹èŒ¶","ï¼ˆå‚™æ¡ˆï¼‰åŒ—éŒå€‰ï¼šåœ“è¦ºå¯º/æ˜æœˆé™¢"]},
            { title: "ä¼´æ‰‹ç¦®", items:["é³©ã‚µãƒ–ãƒ¬ãƒ¼","ç´…è°·ã‚¯ãƒ«ãƒŸãƒƒå­","ç«¹è£½å·¥è—å“"]},
            { title: "å°æé†’", items:["å ±åœ‹å¯ºéšæ¢¯å¤šï¼Œè«‹æ”¾æ…¢","æ™‚é–“ä¸è¶³å¯ç•¥éåŒ—éŒå€‰"]}
          ]
        },
        3: { // éŒå€‰â‘¡
          transport: ["å»ºè­°è³¼è²· æ±Ÿä¹‹é›»ä¸€æ—¥åˆ¸","å‚æ™šï½å¤œé–“å‰å¾€æ±Ÿä¹‹å³¶ Sea Candle è§€ç‡ˆé£¾"],
          meals: { breakfast: "â€”", lunch: "é­šè¦‹äº­ / ã—ã‚‰ã™å•å±‹ ã¨ã³ã£ã¡ã‚‡", dinner: "Il Chianti CafÃ©" },
          lodging: "Kamakura Prince Hotelï¼ˆçºŒä½ï¼‰",
          summary: "é•·è°·å¯ºçœ‹æµ·æ™¯ã€é«˜å¾·é™¢å¤§ä½›ã€å¤œè¨ªã€æ¹˜å—ä¹‹å¯¶çŸ³ã€ã€‚",
          sections: [
            { title: "æ™¯é»èˆ‡äº®é»", items:["é•·è°·å¯º","é«˜å¾·é™¢ï¼ˆéŒå€‰å¤§ä½›ï¼‰","æ±Ÿä¹‹å³¶ Sea Candle å¤œæ™¯"]},
            { title: "å°æé†’", items:["é•·è°·å¯º/å¤§ä½›å»ºè­°ä¸Šåˆé€ è¨ª","æ±Ÿä¹‹å³¶å¯æ­é›»æ¢¯ä¸Šå¡”"]}
          ]
        },
        4: { // å¾¡æ®¿å ´
          transport: ["éŒå€‰ â†’ å¾¡æ®¿å ´ ç´„2å°æ™‚ï¼ˆJR+è½‰ä¹˜ï¼‰","å¾¡æ®¿å ´ç«™ â†’ æ™‚ä¹‹æ –ï¼šå·´å£«/è¨ˆç¨‹è»Šç´„30åˆ†","ç‡ˆé£¾é»ç‡ˆç´„16:30ï¼Œé»ƒæ˜å‰æŠµé”"],
          meals: { breakfast: "â€”", lunch: "â€”", dinner: "å¾¡æ®¿å ´é«˜åŸå•¤é…’é¤å»³ï¼åœ’å…§é£Ÿå ‚" },
          lodging: "æ±æ©«INN å¾¡æ®¿å ´ç«™å‰",
          summary: "æ™‚ä¹‹æ –ç‡ˆæµ·ï¼‹æº«æ³‰ä¼‘æ¯ï¼Œé©åˆå–æ™¯ï¼šå…‰ä¹‹éš§é“ã€ä¸­å¤®å»£å ´ã€å¯Œå£«å±±å‰ªå½±ã€‚",
          sections: [
            { title: "æº«æ³‰", items:["æ°£æ¥½åŠ æˆ– å¾¡æ®¿å ´æº«æ³‰æœƒé¤¨"]},
            { title: "å°æé†’", items:["å¤œé–“æ°£æº«ä½ï¼Œå‚™ä¿æš–è¡£ç‰©","ç¢ºèªè¿”ç¨‹å·´å£«/è¨ˆç¨‹è»Šæ™‚åˆ»"]}
          ]
        },
        5: { // æ²³å£æ¹– ç´…ç·š
          transport: ["å¾¡æ®¿å ´ â†’ æ²³å£æ¹– ç´„1å°æ™‚20åˆ†","ä»¥å‘¨éŠå·´å£« ç´…ç·šï¼ˆKawaguchiko Lineï¼‰ä¸²æ¥æ™¯é»"],
          meals: { breakfast: "â€”", lunch: "ã»ã†ã¨ã†ä¸å‹•", dinner: "é£¯åº—æ‡·çŸ³" },
          lodging: "æ¹–æ¨‚ãŠã‚“ã‚„ã© å¯Œå£«åŸæ™¯",
          summary: "å¤©ä¸Šå±±çºœè»Šã€éŠè¦½èˆ¹ã€éŸ³æ¨‚ç›’ä¹‹æ£®ã€å¤§çŸ³å…¬åœ’ï¼›é»ƒæ˜è‡³å¤œæ‹å¯Œå£«å€’å½±ã€‚",
          sections: [
            { title: "åŠ ç¢¼æ­¥é“", items:["è¦–é«”åŠ›åŠ ç¢¼ å…«æœ¨å´å…¬åœ’æ­¥é“"]},
            { title: "ä¼´æ‰‹ç¦®", items:["FUJIYAMA COOKIE","å¯Œå£«å±±é¦¬å…‹æ¯","æœé†¬/éŸ³æ¨‚ç›’å•†å“"]}
          ]
        },
        6: { // æ²³å£æ¹– ç¶ ç·š
          transport: ["å‘¨éŠå·´å£« ç¶ ç·šï¼ˆSaiko Lineï¼‰ç‚ºä¸»","ä¸Šåˆæ‘è½èˆ‡æ¹–å²¸ï¼Œåˆå¾Œå›æ²³å£æ¹–ç•”æ³¡æ¹¯"],
          meals: { breakfast: "â€”", lunch: "å°ä½œï¼é‡Œã®é§…", dinner: "é£¯åº—æˆ–è¿‘ç«™å±…é…’å±‹" },
          lodging: "å¯Œå£«åŸæ™¯ï¼ˆçºŒä½ï¼‰",
          summary: "è¥¿æ¹–ã„ã‚„ã—ã®é‡Œæ ¹å ´ã€æ¹–å²¸å–æ™¯ï¼›é¸é…å¯Œå²³é¢¨ç©´/é³´æ²¢æ°·ç©´ï¼›å‚æ™šè£œæ‹æ¹–ç•”å¤•æ™¯ã€‚",
          sections: [
            { title: "æ³¨æ„", items:["æ´ç©´å€æ¿•æ»‘ï¼Œè¡Œèµ°æ”¾æ…¢","æ™šé–“æ•´ç†è¡Œæã€ç¢ºèªéš”æ—¥è»Šæ¬¡"]}
          ]
        },
        7: { // ä¸‹å‰ç”° â†’ æ±äº¬
          transport: ["æ²³å£æ¹– â†’ ä¸‹å‰ç”° ç´„20åˆ†","ä¸‹åˆæ­ã€å¯Œå£«å›éŠã€ç‰¹æ€¥è¿”å›æ±äº¬ï¼Œå…¥ä½äº”åç”°"],
          meals: { breakfast: "â€”", lunch: "å¯Œå£«è£½éºµæ‰€", dinner: "é³¥è²´æ—ï¼ç‚­ç«ç„¼è‚‰ã¾ã‚‹ã¿ã¡" },
          lodging: "JRæ±æ—¥æœ¬ãƒ›ãƒ†ãƒ«ãƒ¡ãƒƒãƒ„ ãƒ—ãƒ¬ãƒŸã‚¢ äº”åç”°",
          summary: "æ–°å€‰å¯Œå£«æ·ºé–“ç¥ç¤¾ãƒ»å¿ éˆå¡”â†’ä¸‹å‰ç”°è€è¡—ï¼Œæ™šé–“å¯å‰å¾€æƒ æ¯”å£½èŠ±åœ’å»£å ´/ç›®é»‘å·ç‡ˆé£¾ã€‚",
          sections: [
            { title: "ä¼´æ‰‹ç¦®", items:["å¯Œå£«æ›é£¾","å¿ éˆå¡”æ˜ä¿¡ç‰‡"]},
            { title: "è¡Œæ", items:["å¯ä½¿ç”¨å®…é…ï¼ˆæ²³å£æ¹–â†’æ±äº¬ï¼‰"]}
          ]
        },
        8: { // æ™´ç©ºå¡”
          transport: ["äº”åç”° â†’ æŠ¼ä¸Š ç´„35åˆ†ï¼ˆJR/åœ°éµï¼‰","ä¸Šåˆç™»å¡”ï¼Œä¸‹åˆè³¼ç‰©èˆ‡æ°´æ—é¤¨"],
          meals: { breakfast: "â€”", lunch: "å…­å˜èˆ TOKYOï¼Musashi Sushi", dinner: "Solamachi ç¾é£Ÿè¡—" },
          lodging: "äº”åç”°ï¼ˆçºŒä½ï¼‰",
          summary: "æ™´ç©ºå¡”è§€æ™¯å°ã€Solamachiã€å¢¨ç”°æ°´æ—é¤¨ï¼›å‚æ™šçœ‹å¡”ç‡ˆè®ŠåŒ–ã€‚",
          sections: [
            { title: "æé†’", items:["å¯ç·šä¸Šé ç´„é–€ç¥¨","æ‹ç…§é¿å…ç»ç’ƒåå…‰"]}
          ]
        },
        9: { // ä¸¸ä¹‹å…§ãƒ»å…­æœ¬æœ¨
          transport: ["å±±æ‰‹ç·š+åœ°éµç§»å‹•","ç™½å¤©æ±äº¬è»Šç«™/ä¸¸ä¹‹å…§ï¼Œå¤œè¨ªå…­æœ¬æœ¨"],
          meals: { breakfast: "â€”", lunch: "æ‹‰éºµæ©«ä¸", dinner: "Union Square Tokyo æˆ– éº»å¸ƒåç•ª Kintan" },
          lodging: "äº”åç”°ï¼ˆçºŒä½ï¼‰",
          summary: "æ±äº¬è»Šç«™ç´…ç£šç«™èˆã€KITTE å±‹ä¸Šåº­åœ’ã€ä¸‰è±ä¸€è™Ÿé¤¨ç¾è¡“é¤¨ï¼›æ™šé–“å…­æœ¬æœ¨ Hills/æ±äº¬ä¸­åŸç‡ˆé£¾ã€‚",
          sections: [
            { title: "æé†’", items:["ä¸¸ä¹‹å…§æ­¥è¡Œå€å¹³ç·©","ç†±é–€é¤å»³å»ºè­°è¨‚ä½"]}
          ]
        },
        10: { // æ¾€è°· â†’ ç¾½ç”°é£¯åº—
          transport: ["äº”åç”° â†’ æ¾€è°· ç´„10åˆ†","æ™šé–“è½‰å¾€ç¾½ç”°æ©Ÿå ´é£¯åº—"],
          meals: { breakfast: "â€”", lunch: "å®‡ç”°å·ã‚«ãƒ•ã‚§ï¼ä¸€è˜­", dinner: "ç¾½ç”°é¤å»³è¡—" },
          lodging: "ãƒ´ã‚£ãƒ©ãƒ•ã‚©ãƒ³ãƒ†ãƒ¼ãƒŒ ã‚°ãƒ©ãƒ³ãƒ‰ ç¾½ç”°ç©ºæ¸¯",
          summary: "æ¾€è°· Scrambleã€PARCO/109/Hikarieã€SHIBUYA SKYï¼›ä»£ä»£æœ¨å…¬åœ’ã€æ˜æ²»ç¥å®®ã€‚",
          sections: [
            { title: "å‹•ç·š", items:["å¯é¸å“å·è½‰äº¬æ€¥ æˆ– æ¿±æ¾ç”ºè½‰å–®è»Œè‡³ç¾½ç”°"]},
            { title: "æé†’", items:["22:00 å‰æ•´ç†è¡Œæã€ç¢ºèªç™»æ©Ÿè³‡è¨Š"]}
          ]
        },
        11: { // è¿”å°æ—¥
          transport: ["æ­¥è¡Œè‡³ç¬¬ä¸‰èˆªå»ˆ ç´„10â€“15åˆ†","JL97 ç¾½ç”°ä¸‰èˆª 08:40 â†’ æ¾å±±ä¸€èˆª 11:40"],
          meals: { breakfast: "å’–å•¡/éºµåŒ…åŠè¼•é£Ÿ", lunch: "â€”ï¼é£›æ©Ÿé¤", dinner: "â€”" },
          lodging: "â€”",
          summary: "æ©Ÿå ´æ¡è²·ï¼šæ±äº¬é¦™è•‰ã€Royceã€é™å®šæ¨¡å‹ï¼›é€šé—œå¾Œè¿”å°ã€‚",
          sections: [
            { title: "å°æé†’", items:["éš¨èº«ç‰©é›†ä¸­ç®¡ç†ï¼Œææ—©é€šéå®‰æª¢","ææ—©æŠµé”ç™»æ©Ÿå£ï¼Œç•™æ„çœ‹æ¿èˆ‡å»£æ’­"]}
          ]
        }
      };

      // æ—¢æœ‰å“ç‰Œ/æ™¯é»å®˜æ–¹é€£çµï¼ˆå¯é€æ­¥æ“´å……ï¼‰
      const POI_LINKS = {
        "ç´…ç£šå€‰åº«": "https://www.yokohama-akarenga.jp/",
        "YOKOHAMA MILIGHT": "https://www.yokohama-minatomirai21.com/",
        "é¶´å²¡å…«å¹¡å®®": "https://www.hachimangu.or.jp/",
        "å ±åœ‹å¯º": "https://www.houkokuji.or.jp/",
        "é•·è°·å¯º": "https://www.hasedera.jp/",
        "é«˜å¾·é™¢": "https://www.kotoku-in.jp/",
        "æ±Ÿä¹‹é›»": "https://www.enoden.co.jp/",
        "æ±Ÿä¹‹å³¶": "https://enoshima-seacandle.com/",
        "æ™‚ä¹‹æ –": "https://www.tokinosumika.com/",
        "å¤©ä¸Šå±±çºœè»Š": "https://www.fujikyu.co.jp/ropeway/",
        "éŸ³æ¨‚ç›’ä¹‹æ£®": "https://kawaguchikomusicforest.jp/",
        "å¤§çŸ³å…¬åœ’": "https://www.fujisan.ne.jp/",
        "è¥¿æ¹–ã„ã‚„ã—ã®é‡Œæ ¹å ´": "https://www.fujisan.ne.jp/spot/99/",
        "å¯Œå²³é¢¨ç©´": "https://www.mtfuji-cave.com/",
        "é³´æ²¢æ°·ç©´": "https://www.mtfuji-cave.com/",
        "æ–°å€‰å¯Œå£«æ·ºé–“ç¥ç¤¾": "https://www.arakurayama-sengen.jp/",
        "æ™´ç©ºå¡”": "https://www.tokyo-skytree.jp/",
        "Solamachi": "https://www.tokyo-solamachi.jp/",
        "å¢¨ç”°æ°´æ—é¤¨": "https://www.sumida-aquarium.com/",
        "KITTE": "https://marunouchi.jp-kitte.jp/",
        "å…­æœ¬æœ¨Hills": "https://www.roppongihills.com/",
        "æ±äº¬ä¸­åŸ": "https://www.tokyomidtown.com/jp/",
        "SHIBUYA SKY": "https://www.shibuya-scramble-square.com/sky/",
        "æ˜æ²»ç¥å®®": "https://www.meijijingu.or.jp/",
        "ãƒ´ã‚£ãƒ©ãƒ•ã‚©ãƒ³ãƒ†ãƒ¼ãƒŒ ã‚°ãƒ©ãƒ³ãƒ‰ ç¾½ç”°ç©ºæ¸¯": "https://hvf.jp/haneda/grand/",
        "Hotel New Otani Yokohama Premium": "https://www.newotani.co.jp/en/yokohama/"
      };

      const escReg = s => s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      function linkify(txt=''){
        let out = String(txt ?? '');
        const entries = Object.entries(POI_LINKS).sort((a,b)=>b[0].length-a[0].length);
        const placeholders = [];
        entries.forEach(([k,url], idx)=>{
          if(!k) return; const ph = `__POI_${idx}__`;
          if (out.indexOf(k) !== -1) { out = out.split(k).join(ph); placeholders[idx] = `<a href="${url}" target="_blank" rel="noopener" class="underline decoration-dotted">${k}</a>`; }
          else { placeholders[idx] = null; }
        });
        placeholders.forEach((html, idx)=>{ if(html) out = out.split(`__POI_${idx}__`).join(html); });
        return out;
      }
      const ul = items => `<ul class="list-disc pl-5 space-y-1">${(items||[]).map(i=>`<li>${linkify(i)}</li>`).join('')}</ul>`;

      const mealsBlock = m => `
        <div class="rounded-xl border p-3 text-sm bg-white">
          <div class="flex items-center gap-2 mb-2">ğŸ½ï¸ ä¸‰é¤</div>
          <ul class="space-y-1">
            <li>æ—©é¤ï¼š${linkify((m && m.breakfast) || '')}</li>
            <li>åˆé¤ï¼š${linkify((m && m.lunch) || '')}</li>
            <li>æ™šé¤ï¼š${linkify((m && m.dinner) || '')}</li>
          </ul>
        </div>`;

      const lodgingBlock = txt => `
        <div class="rounded-xl border p-3 text-sm bg-white">
          <div class="flex items-center gap-2 mb-2">ğŸ›ï¸ ä½å®¿</div>
          <div>${linkify(txt || '')}</div>
        </div>`;

      const galleryHTML = (day, urls=[]) => `
        <div class="gallery-grid mt-2" data-day="${day}">
          ${urls.map(u=>`<div class="gallery-item aspect-fixed"><img src="${u}" alt="d${day}" class="w-full h-full object-cover cursor-zoom-in" loading="lazy" decoding="async" referrerpolicy="no-referrer" crossorigin="anonymous"></div>`).join('')}
        </div>`;

      const cardHTML = (d, det) => `
        <div id="day-${d.day}" class="shadow-sm rounded-xl border bg-white scroll-mt-24">
          <div class="p-4 border-b">
            <div class="flex items-baseline justify-between flex-wrap gap-2">
              <div class="flex items-center gap-3">
                <span class="inline-flex items-center justify-center rounded-full bg-black text-white px-3 py-1 text-base md:text-lg font-semibold">ç¬¬ ${d.day} å¤©</span>
                <span class="text-lg md:text-2xl font-semibold tracking-tight">${d.date}</span>
              </div>
            </div>
            <div class="text-xl md:text-2xl mt-2 font-semibold">${linkify(d.title)}</div>
          </div>
          ${(det.summary ? `<div class="px-4 pt-2 text-gray-700 text-sm md:text-base">${linkify(det.summary)}</div>` : '')}
          ${galleryHTML(d.day, d.gallery)}
          <!-- äº¤é€šå‹•ç·š -->
          <div class="rounded-xl border p-3 text-sm bg-white mt-2">
            <div class="flex items-center gap-2 mb-2">ğŸš† äº¤é€šå‹•ç·š</div>
            ${ul(det.transport || [])}
          </div>
          <!-- é¤é£Ÿ/ä½å®¿ -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-2">
            ${mealsBlock(det.meals || {})}
            ${lodgingBlock(det.lodging || '')}
          </div>
          <!-- å±•é–‹è¡Œç¨‹å…§å®¹ -->
          <details class="border rounded-xl mt-2 mb-6 group">
            <summary class="w-full flex items-center justify-between px-3 py-2 text-sm cursor-pointer list-none">
              <span class="flex items-center gap-2"><span class="chev transition-transform group-open:rotate-180">â–¾</span> å±•é–‹è¡Œç¨‹å…§å®¹</span>
            </summary>
            <div class="px-4 pb-3 text-sm text-gray-600 space-y-4">
              ${(det.sections||[]).map(sec=>`
                <div>
                  <div class="font-medium text-gray-800 mb-1">${sec.title}</div>
                  ${ul(sec.items||[])}
                </div>
              `).join('')}
            </div>
          </details>
        </div>`;

      function renderItinerary(){
        const wrap = document.getElementById('itineraryList');
        wrap.innerHTML = DATA.itinerary.map(d => cardHTML(d, DETAILS[d.day]||{})).join('');
      }

      // åœ–ç‰‡å±•ç¤ºæ¨¡å¼åˆ‡æ›
      function bindModeToggle(){
        const btn = document.getElementById('modeToggle'); if(!btn) return;
        const sync = () => btn.textContent = document.body.classList.contains('mode-natural') ? 'é¡¯ç¤ºæ¨¡å¼ï¼šåŸæ¯”ä¾‹' : 'é¡¯ç¤ºæ¨¡å¼ï¼šä¸€è‡´å°ºå¯¸';
        btn.addEventListener('click', ()=>{ document.body.classList.toggle('mode-natural'); sync(); });
        sync();
      }

      // Lightbox
      function bindLightbox(){
        const lb = document.getElementById('lightbox');
        const lbImg = document.getElementById('lightboxImg');
        const lbClose = document.getElementById('lightboxClose');
        if(!lb || !lbImg) return;
        document.querySelectorAll('.gallery-grid img').forEach(img => {
          img.addEventListener('click', () => {
            lbImg.src = img.getAttribute('data-fullsrc') || img.src;
            if(typeof lb.showModal === 'function') lb.showModal();
          }, {passive:true});
        });
        lbClose && lbClose.addEventListener('click', ()=> lb.close());
        lb.addEventListener('click', (e)=>{ if(e.target===lb) lb.close(); });
        window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && lb.open) lb.close(); });
      }

      // å¤–é€£åœ–ç‰‡å®¹éŒ¯ï¼ˆé¿å…ç«™é»é˜»æ“‹ hotlinkï¼‰
      function proxyURL(u, opts={}){
        try{
          const x = new URL(u);
          const params = new URLSearchParams();
          const w = opts.w || 1280; params.set('url', x.host + x.pathname + (x.search||'')); params.set('w', w); params.set('output', 'webp');
          return 'https://images.weserv.nl/?' + params.toString();
        }catch(e){ return u; }
      }
      function bindImgFallback(){
        const attach = (img)=>{
          const toProxy = () => { if(img.dataset.fallback) return; img.dataset.fallback = '1'; img.src = proxyURL(img.src); };
          img.addEventListener('error', toProxy, {passive:true});
          let timer = null;
          const onEnter = (entries)=>{ entries.forEach(en=>{ if(en.isIntersecting){ if(img.complete) return; if(timer) return; timer = setTimeout(()=>{ if(!img.complete) toProxy(); }, 2500); } }); };
          const io = new IntersectionObserver(onEnter, {rootMargin: '200px'}); io.observe(img);
          img.addEventListener('load', ()=>{ if(timer){ clearTimeout(timer); timer=null; } }, {passive:true});
        };
        document.querySelectorAll('img').forEach(attach);
        const obs = new MutationObserver((muts)=>{ muts.forEach(m=>{ m.addedNodes && m.addedNodes.forEach(node=>{ if(node.nodeType===1){ if(node.tagName==='IMG') attach(node); node.querySelectorAll && node.querySelectorAll('img').forEach(attach); } }); }); });
        obs.observe(document.body, {childList:true, subtree:true});
      }

      // åŒ¯å‡º JSON æª”
      document.getElementById('dljson').addEventListener('click', () => {
        const blob = new Blob([JSON.stringify({DATA, DETAILS}, null, 2)], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'tokyo-yokohama-kawaguchiko.json'; a.click(); URL.revokeObjectURL(url);
      });

      // ===== Self-tests (sanity checks) =====
      function runSelfTests(){
        try {
          console.assert(Array.isArray(DATA.itinerary), 'itinerary should be an array');
          console.assert(DATA.itinerary.length === 11, 'itinerary should have 11 days');
          const days = DATA.itinerary.map(d=>d.day);
          console.assert(days.join(',') === '1,2,3,4,5,6,7,8,9,10,11', 'days should be 1..11');
          console.assert(DATA.itinerary.every(d=>Array.isArray(d.gallery)), 'each day.gallery should be an array');
          console.assert(DATA.flights.outbound.depTime && DATA.flights.inbound.arrTime, 'flight times should be set');
          // DOM render check (after renderItinerary) â€” schedule at next tick
          setTimeout(()=>{
            const wrap = document.getElementById('itineraryList');
            console.assert(wrap && wrap.children.length === 11, 'should render 11 day cards');
          }, 0);
        } catch(e){
          console.error('Self-tests failed:', e);
        }
      }

      // åˆå§‹åŒ–
      renderItinerary();
      bindModeToggle();
      bindLightbox();
      bindImgFallback();
      runSelfTests();
    </script>
  </body>
</html>
